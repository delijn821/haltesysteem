
<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Lijn 88 — Mechelen Station</title>
<style>

@font-face {
    font-family: 'FlandersArtSans';
    src: url('fonts/FlandersArtSans-Bold.woff') format('woff');
    font-weight: 600;
    font-style: normal;
}

@font-face {
    font-family: 'FlandersArtSans';
    src: url('fonts/FlandersArtSans-Medium.woff') format('woff');
    font-weight: 500;
    font-style: normal;
}

@font-face {
    font-family: 'FlandersArtSans';
    src: url('fonts/FlandersArtSans-Regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
}


body {
    font-family: 'FlandersArtSans', Arial, sans-serif;
    background-color: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    height: 100vh;
    margin: 0;
    overflow: hidden;
    padding-top: 3%;
    padding-left: 5%;
    padding-right: 5%;
}

.header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.line-info {
    display: flex;
    align-items: center;
    gap: 20px;
}

.line-box {
    background-color: #A85E24;
    color: #FFFFFF;
    -webkit-text-stroke: 2px #000;
    padding: 5px 20px;
    border-radius: 25px;
    font-size: 4.75em;
    font-weight: 600;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
}

.destination {
    font-size: 3.75em;
    font-weight: 500;
}

.clock {
    font-size: 3.5em;
    font-weight: 400;
}

.stops {
    display: flex;
    padding-top: 3%;
    flex-grow: 1;
    overflow: hidden;
    flex-direction: column;
    gap: 15px;
    font-size: 2.25em;
    font-weight: 500;
    width: 100%;
    text-align: left;
}

.stop {
    background-color: #333;
    border-radius: 15px;
    padding: 15px;
}

.footer {
    font-size: 3em;
    font-weight: 500;
    margin-top: auto;
    margin-bottom: 3%;
    width: 100%;
    text-align: center;
    padding: 2%;
    border-top: 2px solid #444;
}
</style>
</head>
<body>
<div class="header">
    <div class="line-info">
        <span class="line-box">88</span>
        <span class="destination">Mechelen Station</span>
    </div>
    <div class="clock" id="clock"></div>
</div>

<div class="stops" id="stops-container"></div>

<div class="footer" id="next-stop">Volgende halte: —</div>

<script>
const haltes = [{"stop_name": "Londerzeel Station perron 3", "stop_lat": 51.008776, "stop_lon": 4.298484}, {"stop_name": "Londerzeel Chrysantenlaan", "stop_lat": 51.005627, "stop_lon": 4.302018}, {"stop_name": "Londerzeel Lode Meeusplein", "stop_lat": 51.002923, "stop_lon": 4.303285}, {"stop_name": "Londerzeel Brandweer", "stop_lat": 51.004184, "stop_lon": 4.306991}, {"stop_name": "Londerzeel Autosnelweg", "stop_lat": 51.007209, "stop_lon": 4.315205}, {"stop_name": "Londerzeel Berg", "stop_lat": 51.007283, "stop_lon": 4.324277}, {"stop_name": "Ramsdonk Hagelboom", "stop_lat": 51.009936, "stop_lon": 4.330146}, {"stop_name": "Ramsdonk Grotstraat", "stop_lat": 51.011073, "stop_lon": 4.334729}, {"stop_name": "Ramsdonk Dreef", "stop_lat": 51.012624, "stop_lon": 4.341373}, {"stop_name": "Kapelle-op-den-Bos Mechelbaan 67", "stop_lat": 51.013904, "stop_lon": 4.34848}, {"stop_name": "Kapelle-op-den-Bos Kerk", "stop_lat": 51.012991, "stop_lon": 4.35526}, {"stop_name": "Kapelle-op-den-Bos Station", "stop_lat": 51.011055, "stop_lon": 4.359618}, {"stop_name": "Kapelle-op-den-Bos Larockstraat", "stop_lat": 51.011411, "stop_lon": 4.369272}, {"stop_name": "Leest Biststraat", "stop_lat": 51.011767, "stop_lon": 4.378624}, {"stop_name": "Leest Spoorwegtunnel", "stop_lat": 51.011767, "stop_lon": 4.389991}, {"stop_name": "Hombeek Bosstraat", "stop_lat": 51.009467, "stop_lon": 4.395991}, {"stop_name": "Hombeek Schuurken", "stop_lat": 51.009297, "stop_lon": 4.404871}, {"stop_name": "Hombeek Plein", "stop_lat": 51.00774, "stop_lon": 4.414874}, {"stop_name": "Hombeek Huis ten Halve", "stop_lat": 51.008789, "stop_lon": 4.423355}, {"stop_name": "Hombeek Kattestraat", "stop_lat": 51.010702, "stop_lon": 4.430067}, {"stop_name": "Hombeek Kapelleke", "stop_lat": 51.012709, "stop_lon": 4.436275}, {"stop_name": "Hombeek Station", "stop_lat": 51.01297, "stop_lon": 4.442081}, {"stop_name": "Hombeek Dorp", "stop_lat": 51.014763, "stop_lon": 4.444885}, {"stop_name": "Mechelen Procter & Gamble", "stop_lat": 51.015632, "stop_lon": 4.458312}, {"stop_name": "Mechelen Fortuinstraat", "stop_lat": 51.017547, "stop_lon": 4.467142}, {"stop_name": "Mechelen Dodoens", "stop_lat": 51.019734, "stop_lon": 4.470999}, {"stop_name": "Mechelen Brusselpoort", "stop_lat": 51.021214, "stop_lon": 4.474717}, {"stop_name": "Mechelen Oude Brusselsestraat", "stop_lat": 51.02035, "stop_lon": 4.481385}, {"stop_name": "Mechelen Station perron 18", "stop_lat": 51.018924, "stop_lon": 4.483966}];
// index van de halte die momenteel als "huidige" wordt beschouwd in de lijst
let lastClosestIndex = 0;
// onthoud vorige afstand naar "next" stop om te vergelijken of die afneemt
let prevNextDist = null;
// onthoud vorige afstand naar "current" (optioneel, kan gebruikt voor logging/extra checks)
let prevCurrentDist = null;

// Update klok
function updateClock() {
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    document.getElementById('clock').textContent = hours + ':' + minutes;
}
setInterval(updateClock, 1000);
updateClock();

// Bereken afstand tussen 2 GPS-coördinaten (Haversine) -> meter
function distance(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const toRad = x => x * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

// Render functie die de zichtbare haltes in DOM plaatst
function renderStops(startIndex) {
    const visible = haltes.slice(startIndex, startIndex + 5);
    const container = document.getElementById('stops-container');
    container.innerHTML = '';
    visible.forEach(h => {
        const div = document.createElement('div');
        div.className = 'stop';
        div.textContent = h.stop_name;
        container.appendChild(div);
    });
    const nextStop = visible.length > 1 ? visible[1].stop_name : 'Eindhalte bereikt';
    document.getElementById('next-stop').textContent = "Volgende halte: " + nextStop;
}

// initial render
renderStops(lastClosestIndex);

// De hoofdregel: schuif 1 halte op als gebruiker >50m van 'current' is en 'next' dichterbij KOMT
function updateHaltes(userLat, userLon) {
    if (!haltes || haltes.length === 0) return;

    // index van huidige en volgende halte binnen de volledige lijst
    const currentIndex = lastClosestIndex;
    const nextIndex = Math.min(currentIndex + 1, haltes.length - 1);

    const currentStop = haltes[currentIndex];
    const nextStop = haltes[nextIndex];

    // compute afstanden
    const distCurrent = distance(userLat, userLon, parseFloat(currentStop.stop_lat), parseFloat(currentStop.stop_lon));
    const distNext = nextStop ? distance(userLat, userLon, parseFloat(nextStop.stop_lat), parseFloat(nextStop.stop_lon)) : Infinity;

    // Debug (optioneel)
    // console.log("distCurrent:", distCurrent, "distNext:", distNext, "prevNextDist:", prevNextDist);

    // Als prevNextDist nog niet gezet is, initialiseer het (we willen bij eerste meting niet meteen schuiven)
    if (prevNextDist === null) {
        prevNextDist = distNext;
        prevCurrentDist = distCurrent;
        // render en return
        renderStops(lastClosestIndex);
        return;
    }

    // Voorwaarde om op te schuiven:
    // 1) gebruiker is meer dan 50m verwijderd van huidige halte (distCurrent > 50)
    // 2) de afstand naar de volgende halte is **gedaald** t.o.v. vorige meting (distNext < prevNextDist)
    // 3) en we hebben nog een volgende halte (nextIndex > currentIndex)
    if (distCurrent > 50 && distNext < prevNextDist && nextIndex > currentIndex) {
        lastClosestIndex = nextIndex;
        // na opschuiven renderen we de nieuwe zichtbare haltes
        renderStops(lastClosestIndex);
    } else {
        // Geen opschuiving: toch de renders up-to-date houden (kan nodig zijn voor first render)
        renderStops(lastClosestIndex);
    }

    // Update prev waarden voor volgende check
    prevNextDist = distNext;
    prevCurrentDist = distCurrent;
}

// Vraag GPS-locatie van apparaat en update
function getLocationAndUpdate() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                updateHaltes(lat, lon);
            },
            err => {
                console.warn("GPS-fout: " + err.message);
                // fallback op eerste halte
                updateHaltes(parseFloat(haltes[0].stop_lat), parseFloat(haltes[0].stop_lon));
            },
            {
                enableHighAccuracy: true,
                maximumAge: 5000,
                timeout: 10000
            }
        );
    } else {
        console.warn("Geolocatie niet ondersteund");
        updateHaltes(parseFloat(haltes[0].stop_lat), parseFloat(haltes[0].stop_lon));
    }
}

// eerste aanroep + interval
getLocationAndUpdate();
// Hier gebruik je 7500ms zoals in je code (pas aan naar 15000 indien gewenst)
setInterval(getLocationAndUpdate, 7500);
</script>
</body>
</html>
